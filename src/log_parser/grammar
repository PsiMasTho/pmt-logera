%token-path ../scanner/token_enums.h

%token DECL_VAR
%token IDENT
%token DECL_ATTR
%token ATTR
%token REGEX
%token DATE
%token VALUE

%stype std::string

%%

input:
    // empty
|
    input line
;

line:
    date '\n'
    {
       d_logData.setActiveDate(Date($1));
    }
|
    assign_attributes
|
    '\n'
;

date:
    DATE
    {
        $$ = d_scanner.matched();
    }
;

value:
    VALUE
    {
        $$ = std::string(d_scanner.matched()).substr(1); // skip '$' char
    }
;

assign_attributes:
    identifier ':' '\n' attribute value
    {
        d_logData.startNewLogLineForNewVar($1);
        d_logData.addAttrToActiveVar($4, $5);
    }
|
    assign_attributes attribute value
    {
        d_logData.addAttrToActiveVar($2, $3);
    }
|
    '\n' attribute value
    {
        d_logData.startNewLogLineForActiveVar();
        d_logData.addAttrToActiveVar($2, $3);
    }
;

identifier:
    IDENT
    {
        $$ = d_scanner.matched();
    }
;

attribute:
    ATTR
    {
        $$ = std::string(d_scanner.matched()).substr(1);
    }
;